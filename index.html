<!DOCTYPE html>
<html>

<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<link rel="stylesheet" type="text/css" href="pokeWho.css">

<script src='//code.jquery.com/jquery-1.11.0.min.js'></script>
<script src="jquery.csv-0.71.min.js"></script>

<title>PokeWho?</title>

</head>

<body>

<div id="mainContent">

<!-- Title -->
<p id="titleText"> Who's That Pokemon? </p>

<p id="introText"> This game is based on the guessing game from the show, except I chose to show the actual Pokemon instead of just the silhouette! Choose which generations you want to play from at the right (the default is all generations). Images are obtained from <a href="http://archives.bulbagarden.net/w/index.php?title=Category:Ken_Sugimori_Pok%C3%A9mon_artwork&fileuntil=*092%0A092Gastly+RG.png#mw-category-media" style="color: yellow">Bulbapedia</a> and were drawn by Ken Sugimori. I use a database obtained from <a href="https://github.com/veekun/pokedex/blob/master/pokedex/data/csv/pokemon_species.csv" style="color: yellow">Veekun's Github</a> (thanks!).</p>

<!---------- PAGE LEFT --------->
<div id="leftSide">

<!-- Main Image Box -->
<div id="imageBox" class="pokeBox">
<img id="myImg" src="http://t2.gstatic.com/images?q=tbn:ANd9GcReehil_3oUTa3YqXmfDcOYmjvIT_DYpw3oUmSnmj3gqAGx__eh"/>
</div>

</div>
<!---------- END OF PAGE LEFT --------->



<!---------- PAGE RIGHT --------->
<div id="rightSide">


<!---------- SCORE BOX --------->
<div id="scoreBox">

<!-- Current Score -->
<div id="currScore" class="pokeBox">
<p class="pokeBoxTitle">Score</p>
<p id="currScoreDisp"></p>
</div>


<!-- High Score -->
<div id="highScore" class="pokeBox">
<p class="pokeBoxTitle">High Score</p>
<p id="highScoreDisp">99</p>
</div>

</div>
<!------- END OF SCORE BOX ------->



<!------- GENERATION PICKER ------->
<div id="genPicker" class="pokeBox">
<p class="pokeBoxTitle">Choose Your Generations:</p>

<div id="gen1to3">
<input type="checkbox" id="gen1">I<br>
<input type="checkbox" id="gen2">II<br>
<input type="checkbox" id="gen3">III<br>
</div>

<div id="gen4to6">
<input type="checkbox" id="gen4">IV<br>
<input type="checkbox" id="gen5">V<br>
<input type="checkbox" id="gen6">VI<br>
</div>

</div>
<!--- END OF GENERATION PICKER ---->



<!------- GUESS INPUT BOX --------->
<div id="guessBox" class="pokeBox">
<p class="pokeBoxTitle">Who is it?<p>
<input id="guess" type="text">
<button id="submitGuess">Take a Guess</button>
<button id="skip">Skip</button>
</div>
<!--- -END OF GUESS INPUT BOX ------>




<!----------- STATUS BOX ------------>
<div id="statusBox" class="pokeBox">
<p class="pokeBoxTitle">Guesses Left:</p>
<p id="guessesLeft"></p>
</div>
<!-------- END OF STATUS BOX --------->


</div>
<!---------- END OF PAGE RIGHT --------->


</div>
<!------- END OF MAIN CONTENT --------->


<script>

var pkmnName; 		// This is the actual name: Bulbasaur
var pkmnID;		// The pokemon's ID.
var pkmnFileName; 	// Bulbasaur001.png
var myURL;		// This is the URL the image ajax request
var csvArray;		// This is the csv pokemon database file
var generationArray = [1, 2, 3, 4, 5, 6]; 	//This stores which generations have been selected
var score = 0;		// The current score
var myHigh = localStorage.getItem("highScore");	// The high score

$("#currScoreDisp").html(score);

var troublesomeIndex;

var troublesomeIds = [29, 32, 83, 122, 233, 250, 439, 474, 487, 492, 585, 586, 669];

var troublesomeNames = ["Nidoran", "Nidoran", 
	"Farfetch'd", "Mr._Mime", "Porygon2", 
	"Ho-Oh", "Mime_Jr", "Porygon-Z", 
	"Giratina-Altered", "Shaymin-Land", 
	"Deerling-Spring", "Sawsbuck-Spring", "Flabébé" ];


// Note: you should probably make some of these names variable
var troublesomeGuessMatch = ["Nidoran", "Nidoran", 
	"Farfetch'd", "Mr. Mime", "porygon2", 
	"Ho-Oh", "Mime Jr.", "Porygon-Z", 
	"Giratina", "Shaymin", 
	"Deerling", "Sawsbuck", "Flabebe"];



// GUESSES
var guessesLeft = 3;
$("#guessesLeft").html(guessesLeft);


// ITERATION
//var i = 1;

// TROUBLESOME
//var i = 0;


function setupHighScore() {

	if (myHigh === null) {
		localStorage.setItem("highScore", "0");
		myHigh = localStorage.getItem("highScore");
	}

	$("#highScoreDisp").html(myHigh);
}

function changeHighScore() {

	if (score > myHigh) {
		localStorage.setItem("highScore", score.toString());
		myHigh = score.toString();
	}

	$("#highScoreDisp").html(myHigh);
}


function randomVal(minRange, maxRange) {
	return (Math.floor((Math.random() * (maxRange - minRange + 1)) + minRange));
}

function getRandomId() {

	if (generationArray.length != 0) {

	var whichGen = generationArray[(randomVal(0, (generationArray.length - 1)))];
	console.log(whichGen);
	if (whichGen === 1) {
		return randomVal(1, 151);
	} else if (whichGen === 2) {
		return randomVal(152, 251);
	} else if (whichGen === 3) {
		return randomVal(252, 386);
	} else if (whichGen === 4) {
		return randomVal(387, 493);
	} else if (whichGen === 5) {
		return randomVal(494, 649);
	} else if (whichGen === 6) {
		return randomVal(650, 719);
	}
	} else {
		return pkmnID;
	}
}


function jsonSuccess(jsonFile) {
	var dataStr = jsonFile.query.pages["-1"].imageinfo[0].url;
	$("#myImg").attr("src", dataStr);
	//console.log("Made a successful JSON call...");

	// ITERATION
	//i++;
	//if (i < 720) { reset(); } else { console.log("I Mean It..."); }; 

	// TROUBLESOME
	//i++;
};

function jsonCall() {
	//pkmnID = Math.floor((Math.random() * 719) + 1);

	pkmnID = getRandomId();	

	// TROUBLESOME
	//if (!(i < troublesomeIds.length)) {
	//	pkmnID = Math.floor((Math.random() * 719) + 1);
	//} else {
	//	pkmnID = troublesomeIds[i];
	//}

	// ITERATION
	// var pkmnID = i;
	
	//console.log(pkmnID);


	troublesomeIndex = $.inArray(pkmnID, troublesomeIds);

	if (troublesomeIndex > -1) {
		pkmnName = troublesomeNames[troublesomeIndex];
	} else {
		// This code goes through the csv array and gets
		// the pokemon's name, capitalizing it
		pkmnName = csvArray[pkmnID][1];
		pkmnName = pkmnName.substring(0,1).toUpperCase() + pkmnName.substring(1);
	}

	
	// This section of code was used to see which pokemon would cause a pkmnName
	// that would not match what a user would input, or would throw an invalid
	// character error.
	//if (!(/^[a-zA-Z]+$/.test(pkmnName))) {
	//	console.log(pkmnName + "..." + pkmnID);
	//}






	// myPkmnID is used to get the dex number of the pokemon
	// to be used to get the png image from bulbapedia
	var myPkmnIDStr = csvArray[pkmnID][0];	
	while (myPkmnIDStr.length < 3) {
		myPkmnIDStr = "0" + myPkmnIDStr;
	}


	pkmnFileName = myPkmnIDStr + pkmnName + ".png";

	myURL = "http://bulbapedia.bulbagarden.net/w/api.php?action=query&format=json&titles=File:"+ pkmnFileName +"&prop=imageinfo&iiprop=url";
	

	$.ajax({
		dataType: "jsonp",
		url: myURL,
		statusCode: {
			404: function () { alert("page not found"); }
		},
		success: jsonSuccess,
		async: false,
	});
}

function csvCall() {
	$.ajax({
		url: "pokemon_species.csv",
		dataType: "text",
		success: csvSuccess,
	});
}

function csvSuccess(csvFile) {
	csvArray = $.csv.toArrays(csvFile);
	console.log("Made a successful CSV call...");
}



function reset() {
	jsonCall();
}

$("#skip").click(function() {
	reset();
});

$("#submitGuess").click(function() {
	console.log("Submit ran...");
	var myGuess = $("#guess").val();

	if (troublesomeIndex > -1) {

		if (myGuess == troublesomeGuessMatch[troublesomeIndex]) {
			console.log("Made a correct troublesome guess!");
			score += 1;
			$("#currScoreDisp").html(score);
			changeHighScore();
			reset();

			// GUESSES (ideally no guess reset and you eventually lose)
			guessesLeft = 3;
			$("#guessesLeft").html(guessesLeft);

		} else {
			console.log("Incorrect troublesome guess!");
	
			// GUESSES
			if (guessesLeft == 1) {
				console.log("Out of troublesome guesses!");
				reset();
				// Ideally this would end the game
				guessesLeft = 3;
				$("#guessesLeft").html(guessesLeft);
			} else {
				guessesLeft -= 1;
				$("#guessesLeft").html(guessesLeft);
			}
		}

	} else {	


		if (/^[a-zA-Z]+$/.test(myGuess)) {
			console.log("Has only letters...");
			if (myGuess.toLowerCase() == pkmnName.toLowerCase()) {

				// You need to check for stuff like giratina-altered is
				// giratina, and Mr. mime without the underscore etc.
				console.log("Made a correct guess!");
				score += 1;
				$("#currScoreDisp").html(score);
				changeHighScore();
				reset();
	
	
				// GUESSES (ideally no guess reset and you eventually lose)
				guessesLeft = 3;
				$("#guessesLeft").html(guessesLeft);


			} else {
				console.log("Incorrect guess!");
	
				// GUESSES
				if (guessesLeft == 1) {
					console.log("Out of guesses!");
					reset();
					// Ideally this would end the game
					guessesLeft = 3;
					$("#guessesLeft").html(guessesLeft);
				} else {
					guessesLeft -= 1;
					$("#guessesLeft").html(guessesLeft);
				}
			}
		} else {
			console.log("Has invalid characters...");
		}
	}
});


function changeGenArray(genNum) {
	if (!($("#gen" + genNum).prop("checked"))) {
		generationArray = $.grep(generationArray, function(value) {
						return (value != genNum);
					});
		console.log("You removed " + genNum + " from it...");
	} else {
		generationArray.push(genNum);
		console.log("You pushed " + genNum + " to it...");
	}
}	 

function checkCheckboxes() {
	for (var j = 1; j < 7; j++) {	
		console.log("Got to " + j);
		$("#gen" + j).prop("checked", true);
	}

	$("#gen1").on("click", function() {
		changeGenArray(1);
	});
	$("#gen2").on("click", function() {
		changeGenArray(2);
	});
	$("#gen3").on("click", function() {
		changeGenArray(3);
	});
	$("#gen4").on("click", function() {
		changeGenArray(4);
	});
	$("#gen5").on("click", function() {
		changeGenArray(5);
	});
	$("#gen6").on("click", function() {
		changeGenArray(6);
	});
}

$(document).ready(function() {
	csvCall();
	setupHighScore();
	checkCheckboxes();
	});
		
</script>

</body>

