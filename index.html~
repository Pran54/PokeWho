<!DOCTYPE html>
<html>

<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<link rel="stylesheet" type="text/css" href="pokeWho.css">

<script src='//code.jquery.com/jquery-1.11.0.min.js'></script>
<script src="jquery.csv-0.71.min.js"></script>

<title>Project 1</title>

</head>

<body>

<div id="mainContent">

<!-- Title -->
<p id="titleText"> Who's That Pokemon? </p>

<p id="introText"> This game is based on the guessing game from the show, except I chose to show the actual Pokemon instead of just the silhouette! Choose which generations you want to play from at the right (the default is all generations). Images are obtained from <a href="http://archives.bulbagarden.net/w/index.php?title=Category:Ken_Sugimori_Pok%C3%A9mon_artwork&fileuntil=*092%0A092Gastly+RG.png#mw-category-media" style="color: yellow">Bulbapedia</a> and were drawn by Ken Sugimori. I use a database obtained from <a href="https://github.com/veekun/pokedex/blob/master/pokedex/data/csv/pokemon_species.csv" style="color: yellow">Veekun's Github</a> (thanks!).</p>

<!---------- PAGE LEFT --------->
<div id="leftSide">

<!-- Main Image Box -->
<div id="imageBox" class="pokeBox">
<img id="myImg" src="http://t2.gstatic.com/images?q=tbn:ANd9GcReehil_3oUTa3YqXmfDcOYmjvIT_DYpw3oUmSnmj3gqAGx__eh"/>
</div>

</div>
<!---------- END OF PAGE LEFT --------->



<!---------- PAGE RIGHT --------->
<div id="rightSide">


<!---------- SCORE BOX --------->
<div id="scoreBox">

<!-- Current Score -->
<div id="currScore" class="pokeBox">
<p class="pokeBoxTitle">Score</p>
<p id="currScoreDisp"></p>
</div>


<!-- High Score -->
<div id="highScore" class="pokeBox">
<p class="pokeBoxTitle">High Score</p>
<p id="highScoreDisp">99</p>
</div>

</div>
<!------- END OF SCORE BOX ------->



<!------- GENERATION PICKER ------->
<div id="genPicker" class="pokeBox">
<p class="pokeBoxTitle">Choose Your Generations:</p>

<div id="gen1to3">
<input type="checkbox">I<br>
<input type="checkbox">II<br>
<input type="checkbox">III<br>
</div>

<div id="gen4to6">
<input type="checkbox">IV<br>
<input type="checkbox">V<br>
<input type="checkbox">VI<br>
</div>

</div>
<!--- END OF GENERATION PICKER ---->



<!------- GUESS INPUT BOX --------->
<div id="guessBox" class="pokeBox">
<p class="pokeBoxTitle">Who is it?<p>
<input id="guess" type="text">
<br>
<button id="submitGuess">Take a Guess</button>
<button id="skip">Skip</button>
</div>
<!--- -END OF GUESS INPUT BOX ------>




<!----------- STATUS BOX ------------>
<div id="statusBox" class="pokeBox">
<p class="pokeBoxTitle">Guesses Left:</p>
<p id="guessesLeft"></p>
</div>
<!-------- END OF STATUS BOX --------->


</div>
<!---------- END OF PAGE RIGHT --------->


</div>
<!------- END OF MAIN CONTENT --------->


<script>

var pkmnName; 		// This is the actual name: Bulbasaur
var pkmnFileName; 	// Bulbasaur001.png
var myURL;		// This is the URL the image ajax request
var score = 0;
$("#currScoreDisp").html(score);


// GUESSES
var guessesLeft = 3;
$("#guessesLeft").html(guessesLeft);


// ITERATION
//var i = 1;


function jsonSuccess(jsonFile) {
	var dataStr = jsonFile.query.pages["-1"].imageinfo[0].url;
	$("#myImg").attr("src", dataStr);
	
	// ITERATION
	//i++;
	//if (i < 720) { reset(); } else { console.log("I Mean It..."); };
};

function jsonCall(csvFile) {
	var randomNum = Math.floor((Math.random() * 719) + 1);
	

	// ITERATION
	//var randomNum = i;
	
	console.log(randomNum);

	var csvArray = $.csv.toArrays(csvFile);

	if (randomNum === 29) {
		pkmnName = "Nidoran";
	} else if (randomNum === 32) {
		pkmnName = "Nidoran";
	} else if (randomNum === 83) {
		pkmnName = "Farfetch'd";
	} else if (randomNum === 122) {
		pkmnName = "Mr._Mime";
	} else if (randomNum === 250) {
		pkmnName = "Ho-Oh";
	} else if (randomNum === 439) {
		pkmnName = "Mime_Jr";
	} else if (randomNum === 474) {
		pkmnName = "Porygon-Z";
	} else if (randomNum === 487) {
		pkmnName = "Giratina-Altered";
	} else if (randomNum === 492) {
		pkmnName = "Shaymin-Land";
	} else if (randomNum === 585) {
		pkmnName = "Deerling-Spring";
	} else if (randomNum === 586) {
		pkmnName = "Sawsbuck-Spring";
	} else if (randomNum === 669) {
		pkmnName = "Flabébé"; 
	} else {
		// This code goes through the csv array and gets
		// the pokemon's name, capitalizing it
		pkmnName = csvArray[randomNum][1];
		pkmnName = pkmnName.substring(0,1).toUpperCase() + pkmnName.substring(1);
	}

	
	// myPkmnID is used to get the dex number of the pokemon
	// to be used to get the png image from bulbapedia
	var myPkmnID = csvArray[randomNum][0];	
	while (myPkmnID.length < 3) {
		myPkmnID = "0" + myPkmnID;
	}


	pkmnFileName = myPkmnID + pkmnName + ".png";

	myURL = "http://bulbapedia.bulbagarden.net/w/api.php?action=query&format=json&titles=File:"+ pkmnFileName +"&prop=imageinfo&iiprop=url";
	

	$.ajax({
		dataType: "jsonp",
		url: myURL,
		statusCode: {
			404: function () { alert("page not found"); }
		},
		success: jsonSuccess,
	});
}

function csvCall() {
	$.ajax({
		url: "pokemon_species.csv",
		dataType: "text",
		success: jsonCall,
	});
}



function reset() {
	csvCall();
}

$("#skip").click(function() {
	reset();
});

$("#submitGuess").click(function() {
	console.log("Submit ran...");
	var myGuess = $("#guess").val();
	if (/^[a-zA-Z]+$/.test(myGuess)) {
		console.log("Has only letters...");
		if (myGuess.toLowerCase() == pkmnName.toLowerCase()) {

			// You need to check for stuff like giratina-altered is
			// giratina, and Mr. mime without the underscore etc.
			console.log("Made a correct guess!");
			score += 1;
			$("#currScoreDisp").html(score);
			reset();


			// GUESSES (ideally no guess reset and you eventually lose)
			guessesLeft = 3;
			$("#guessesLeft").html(guessesLeft);


		} else {
			console.log("Incorrect guess!");

			// GUESSES
			if (guessesLeft == 1) {
				console.log("Out of guesses!");
				reset();
				// Ideally this would end the game
				guessesLeft = 3;
				$("#guessesLeft").html(guessesLeft);
			} else {
				guessesLeft -= 1;
				$("#guessesLeft").html(guessesLeft);
			}
		}
	} else {
		console.log("Has invalid characters...");
	}
});
		
</script>

</body>

